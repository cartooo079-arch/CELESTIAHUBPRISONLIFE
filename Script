-- CELESTIA HUB v9.0 - PRISON LIFE - FIXED LOAD SCRIPT
-- Safe load, GUI functional, no vararg or coregui issues

-- === WAIT FOR GAME ===
repeat task.wait() until game:IsLoaded()
repeat task.wait() until game.Players.LocalPlayer
repeat task.wait() until game.Players.LocalPlayer:FindFirstChild("PlayerGui")

-- === SERVICES ===
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- === GAME CHECK ===
if game.PlaceId ~= 155615604 then
	warn("⚠️ Wrong game! This script is for PRISON LIFE only.")
	return
end

-- === CHARACTER ===
local character = player.Character or player.CharacterAdded:Wait()
local rootPart = character:WaitForChild("HumanoidRootPart")

-- === STATE ===
local flyEnabled = false
local flySpeed = 60
local flyBV = nil
local espEnabled = false
local espLoop = nil
local espBoxes = {}

-- === GUI ===
local function createGUI()
	local gui = Instance.new("ScreenGui")
	gui.Name = "CelestiaHub"
	gui.ResetOnSpawn = false
	gui.Parent = playerGui

	local frame = Instance.new("Frame")
	frame.Size = UDim2.new(0, 380, 0, 400)
	frame.Position = UDim2.new(0.5, -190, 0.5, -200)
	frame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
	frame.Active = true
	frame.Draggable = true
	frame.Parent = gui

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 12)
	corner.Parent = frame

	local title = Instance.new("TextLabel")
	title.Text = "CELESTIA HUB v9.0"
	title.Size = UDim2.new(1, -60, 0, 50)
	title.Position = UDim2.new(0, 15, 0, 0)
	title.BackgroundTransparency = 1
	title.TextColor3 = Color3.new(1, 1, 1)
	title.Font = Enum.Font.GothamBold
	title.TextSize = 18
	title.TextXAlignment = Enum.TextXAlignment.Left
	title.Parent = frame

	local close = Instance.new("TextButton")
	close.Text = "×"
	close.Size = UDim2.new(0, 40, 0, 40)
	close.Position = UDim2.new(1, -45, 0, 5)
	close.BackgroundTransparency = 1
	close.TextColor3 = Color3.new(1, 0.3, 0.3)
	close.Font = Enum.Font.GothamBold
	close.TextSize = 24
	close.Parent = frame
	close.MouseButton1Click:Connect(function()
		gui:Destroy()
	end)

	local content = Instance.new("ScrollingFrame")
	content.Size = UDim2.new(1, -20, 1, -70)
	content.Position = UDim2.new(0, 10, 0, 60)
	content.BackgroundTransparency = 1
	content.ScrollBarThickness = 5
	content.AutomaticCanvasSize = Enum.AutomaticSize.Y
	content.Parent = frame

	local layout = Instance.new("UIListLayout")
	layout.Padding = UDim.new(0, 8)
	layout.Parent = content

	-- === Toggle Builder ===
	local function addToggle(name, callback)
		local btn = Instance.new("TextButton")
		btn.Size = UDim2.new(1, 0, 0, 40)
		btn.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
		btn.Text = name .. " [OFF]"
		btn.TextColor3 = Color3.new(1, 1, 1)
		btn.Font = Enum.Font.Gotham
		btn.TextSize = 16
		btn.Parent = content

		local c = Instance.new("UICorner", btn)
		c.CornerRadius = UDim.new(0, 8)

		local state = false
		btn.MouseButton1Click:Connect(function()
			state = not state
			btn.Text = name .. (state and " [ON]" or " [OFF]")
			btn.BackgroundColor3 = state and Color3.fromRGB(100, 60, 150) or Color3.fromRGB(60, 60, 70)
			callback(state)
		end)
	end

	-- === Fly ===
	addToggle("Fly", function(on)
		flyEnabled = on
		if on then
			flyBV = Instance.new("BodyVelocity")
			flyBV.MaxForce = Vector3.new(1e5, 1e5, 1e5)
			flyBV.Velocity = Vector3.zero
			flyBV.Parent = rootPart

			task.spawn(function()
				while flyEnabled and task.wait() do
					local cam = Workspace.CurrentCamera
					local dir = Vector3.zero
					if UserInputService:IsKeyDown(Enum.KeyCode.W) then dir += cam.CFrame.LookVector end
					if UserInputService:IsKeyDown(Enum.KeyCode.S) then dir -= cam.CFrame.LookVector end
					if UserInputService:IsKeyDown(Enum.KeyCode.A) then dir -= cam.CFrame.RightVector end
					if UserInputService:IsKeyDown(Enum.KeyCode.D) then dir += cam.CFrame.RightVector end
					if UserInputService:IsKeyDown(Enum.KeyCode.Space) then dir += Vector3.yAxis end
					if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then dir -= Vector3.yAxis end
					flyBV.Velocity = dir.Magnitude > 0 and dir.Unit * flySpeed or Vector3.zero
				end
			end)
		else
			if flyBV then flyBV:Destroy() flyBV = nil end
		end
	end)

	-- === ESP (simple Billboard) ===
	addToggle("ESP", function(on)
		espEnabled = on
		if on then
			for _, p in ipairs(Players:GetPlayers()) do
				if p ~= player then
					local char = p.Character or p.CharacterAdded:Wait()
					local head = char:WaitForChild("Head", 5)
					if head then
						local billboard = Instance.new("BillboardGui")
						billboard.Size = UDim2.new(0, 100, 0, 30)
						billboard.StudsOffset = Vector3.new(0, 2.5, 0)
						billboard.AlwaysOnTop = true
						billboard.Parent = head

						local label = Instance.new("TextLabel")
						label.Size = UDim2.new(1, 0, 1, 0)
						label.BackgroundTransparency = 1
						label.Text = p.Name
						label.TextColor3 = Color3.new(1, 1, 1)
						label.Font = Enum.Font.GothamBold
						label.TextSize = 14
						label.Parent = billboard

						espBoxes[p] = billboard
					end
				end
			end
		else
			for _, v in pairs(espBoxes) do
				if v then v:Destroy() end
			end
			espBoxes = {}
		end
	end)

	print("✅ CELESTIA HUB v9.0 LOADED – GUI VISIBLE")
end

pcall(createGUI)
